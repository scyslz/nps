# NPS æœåŠ¡ç«¯é…ç½®æ–‡ä»¶

ğŸ“Œ **é»˜è®¤é…ç½®æ–‡ä»¶è·¯å¾„**
- **Linux/macOS**ï¼š`/etc/nps/conf/nps.conf`
- **Windows**ï¼š`C:\Program Files\nps\conf\nps.conf`

ğŸ“Œ **æŒ‡å®šè‡ªå®šä¹‰é…ç½®è·¯å¾„**
```bash
# Linux å¯åŠ¨
./nps -conf_path=/app/nps

# Windows å¯åŠ¨
nps.exe -conf_path=D:\test\nps
```

ğŸ“Œ **æ³¨æ„**
- **å‚æ•°ç•™ç©ºå³ä¸ºé»˜è®¤å€¼**
- **ä¿®æ”¹åé‡å¯ NPS ç”Ÿæ•ˆ**
- **æ¶‰åŠå®‰å…¨çš„é…ç½®ï¼Œå¦‚ `web_password`ï¼Œæ­£å¼éƒ¨ç½²æ—¶è¯·ä¿®æ”¹é»˜è®¤å€¼**

---

## 1. åŸºç¡€é…ç½®
| åç§°               | è¯´æ˜ |
|------------------|-------------------------------------|
| `appname`        | åº”ç”¨åç§° |
| `runmode`        | è¿è¡Œæ¨¡å¼ï¼ˆdev/proï¼‰ |
| `dns_server`     | DNS æœåŠ¡å™¨ |

---
## 2. Web ç®¡ç†é¢æ¿ç›¸å…³
| åç§°               | è¯´æ˜ |
|------------------|-------------------------------------|
| `web_port`       | Web ç®¡ç†ç«¯å£ï¼ˆé»˜è®¤ `8081`ï¼‰ |
| `web_ip`         | Web ç®¡ç†ç•Œé¢ç›‘å¬åœ°å€ï¼ˆé»˜è®¤ `0.0.0.0`ï¼Œç›‘å¬æ‰€æœ‰ IPï¼‰ |
| `web_host`       | Web ç•Œé¢åŸŸåï¼ˆé»˜è®¤ `a.o.com`ï¼Œç«¯å£å¤ç”¨æ—¶è®¿é—®ç®¡ç†é¡µé¢çš„åœ°å€ï¼‰ |
| `web_username`   | Web ç®¡ç†å‘˜è´¦å·ï¼ˆé»˜è®¤ `admin`ï¼‰ |
| `web_password`   | Web ç®¡ç†å‘˜å¯†ç ï¼ˆé»˜è®¤ `123`ï¼Œå»ºè®®ä¿®æ”¹ï¼ï¼‰ |
| `web_open_ssl`   | æ˜¯å¦å¯ç”¨ Web é¢æ¿ HTTPSï¼ˆé»˜è®¤ `false`ï¼Œå¯ç”¨éœ€é…ç½®è¯ä¹¦ï¼‰ |
| `web_cert_file`  | Web HTTPS è¯ä¹¦æ–‡ä»¶è·¯å¾„ |
| `web_key_file`   | Web HTTPS è¯ä¹¦å¯†é’¥æ–‡ä»¶è·¯å¾„ |
| `web_base_url`   | Web ç®¡ç†ä¸»è·¯å¾„ï¼ˆé»˜è®¤ `/`ï¼Œé€‚ç”¨äº Web åå‘ä»£ç†æ—¶è°ƒæ•´è·¯å¾„ï¼‰ |
| `open_captcha`   | æ˜¯å¦å¯ç”¨éªŒè¯ç  |

---

## 3. ä»£ç†ç«¯å£ç›¸å…³
| åç§°                 | è¯´æ˜ |
|--------------------|------------------------------|
| `bridge_port`      | å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é€šä¿¡ç«¯å£ï¼ˆé»˜è®¤ `8024`ï¼‰ |
| `bridge_ip`        | ç›‘å¬åœ°å€ï¼ˆé»˜è®¤ `0.0.0.0`ï¼Œç›‘å¬æ‰€æœ‰ IPï¼‰ |
| `bridge_type`      | è¿æ¥æ–¹å¼ï¼ˆ`tcp` æˆ– `kcp`ï¼Œé»˜è®¤ `tcp`ï¼‰ |
| `http_proxy_ip`    | HTTP ä»£ç†ç›‘å¬åœ°å€ï¼ˆé»˜è®¤ `0.0.0.0`ï¼‰ |
| `http_proxy_port`  | HTTP ä»£ç†ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ `80`ï¼Œç•™ç©ºä¸å¯ç”¨ï¼‰ |
| `https_proxy_port` | HTTPS ä»£ç†ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ `443`ï¼Œç•™ç©ºä¸å¯ç”¨ï¼‰ |
| `tls_enable`       | æ˜¯å¦å¼€å¯ TLS åŠ å¯†éš§é“ï¼ˆå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é€šä¿¡ï¼‰ |
| `tls_bridge_port`  | å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é€šä¿¡ TLS ç«¯å£ |

---

## 4. è®¤è¯ä¸å¯†é’¥
| åç§°                 | è¯´æ˜ |
|--------------------|--------------------------------------|
| `auth_key`        | Web API è®¤è¯å¯†é’¥ï¼ˆå»ºè®®å¡«å……å¤æ‚å¯†é’¥ï¼‰ |
| `auth_crypt_key`  | è·å– `authKey` çš„ AES åŠ å¯†å¯†é’¥ï¼ˆ16 ä½ï¼‰ |
| `public_vkey`     | å®¢æˆ·ç«¯ä»¥é…ç½®æ–‡ä»¶æ¨¡å¼å¯åŠ¨æ—¶çš„å¯†é’¥ |

---

## 5. è®¿é—®æ§åˆ¶
| åç§°                  | è¯´æ˜ |
|---------------------|----------------------------|
| `ip_limit`         | æ˜¯å¦é™åˆ¶ IP è®¿é—®ï¼ˆ`true` æˆ– `false`ï¼‰ |
| `allow_ports`      | å…è®¸å®¢æˆ·ç«¯æ˜ å°„çš„ç«¯å£èŒƒå›´ï¼ˆç¤ºä¾‹ï¼š`9001-9009,10001,11000-12000`ï¼‰ |
| `allow_user_login` | æ˜¯å¦å…è®¸ç”¨æˆ·ç™»å½•ç®¡ç†ï¼ˆ`true` æˆ– `false`ï¼‰ |
| `allow_user_register` | æ˜¯å¦å…è®¸ç”¨æˆ·æ³¨å†Œï¼ˆ`true` æˆ– `false`ï¼‰ |
| `allow_user_change_username` | æ˜¯å¦å…è®¸ç”¨æˆ·ä¿®æ”¹ç”¨æˆ·åï¼ˆ`true` æˆ– `false`ï¼‰ |

---

## 6. P2P ç›¸å…³
| åç§°      | è¯´æ˜ |
|---------|--------------------|
| `p2p_ip`  | P2P æœåŠ¡ç«¯ IPï¼ˆä½¿ç”¨ P2P æ—¶éœ€å¡«å†™ï¼‰ |
| `p2p_port` | P2P ç«¯å£ï¼ˆç”¨äº P2P é€šä¿¡ï¼‰ |

---

## 7. æ—¥å¿—ä¸æµé‡æ§åˆ¶
| åç§°                  | è¯´æ˜ |
|---------------------|----------------------------|
| `log_level`        | æ—¥å¿—çº§åˆ«ï¼ˆ`0-7`ï¼Œé»˜è®¤ `7` ä¸º Debug çº§åˆ«ï¼‰ |
| `log_path`         | æ—¥å¿—è·¯å¾„ï¼ˆå¯é€‰ `å…·ä½“è·¯å¾„`ã€`off`ã€`docker`ï¼‰ |
| `log_daily`        | æ˜¯å¦æŒ‰æ—¥æœŸä¿å­˜æ—¥å¿—ï¼ˆ`true` å¼€å¯ï¼Œ`false` å…³é—­ï¼‰ |
| `log_max_files`    | å…è®¸å­˜åœ¨çš„æ—¥å¿—æ€»æ–‡ä»¶ä¸ªæ•°ï¼ˆé»˜è®¤ `10`ï¼‰ |
| `log_max_days`     | å…è®¸ä¿å­˜æ—¥å¿—çš„æœ€å¤§å¤©æ•°ï¼ˆé»˜è®¤ `7`ï¼‰ |
| `log_max_size`     | å•ä¸ªæ—¥å¿—æ–‡ä»¶çš„æœ€å¤§å¤§å°ï¼ˆMBï¼‰ï¼ˆé»˜è®¤ `2MB`ï¼‰ |
| `flow_store_interval` | æµé‡æ•°æ®æŒä¹…åŒ–é—´éš”ï¼ˆåˆ†é’Ÿï¼‰ï¼Œç•™ç©ºè¡¨ç¤ºä¸æŒä¹…åŒ– |

---

## 8. åå‘ä»£ç†ä¸å®‰å…¨
| åç§°                  | è¯´æ˜ |
|---------------------|----------------------------|
| `http_add_origin_header` | æ˜¯å¦æ·»åŠ çœŸå®IPå¤´ï¼ˆ`true` æˆ– `false`ï¼‰ |
| `x_nps_http_only`  | å‰ç½®ä»£ç†ä¼ é€’ `X-NPS-Http-Only` å¤´éªŒè¯ï¼Œä¿¡ä»»è¯¥ä»£ç† |

### **Nginx ä»£ç†ç¤ºä¾‹**
```nginx
server {
    listen 443 ssl;
    server_name example.com;

    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    location / {
        proxy_pass http://127.0.0.1:80;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        proxy_set_header Host $http_host;

        # è¿™é‡Œå¡« NPS é…ç½®æ–‡ä»¶ä¸­å¡«å†™çš„å¯†ç 
        proxy_set_header X-NPS-Http-Only "password";
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

        proxy_redirect off;
        proxy_buffering off;
    }
}
```

---

## 9. å…¶ä»–é«˜çº§é…ç½®
| åç§°                  | è¯´æ˜ |
|---------------------|----------------------------|
| `allow_flow_limit` | æ˜¯å¦å…è®¸æµé‡é™åˆ¶ |
| `allow_rate_limit` | æ˜¯å¦å…è®¸å¸¦å®½é™åˆ¶ |
| `allow_time_limit` | æ˜¯å¦å…è®¸åˆ°æœŸæ—¶é—´é™åˆ¶ |
| `allow_tunnel_num_limit` | æ˜¯å¦å…è®¸é™åˆ¶å®¢æˆ·ç«¯æœ€å¤§éš§é“æ•° |
| `allow_local_proxy` | æ˜¯å¦å…è®¸ NPS æœ¬åœ°ä»£ç†è¿æ¥ï¼ˆç›¸å½“äºåœ¨npsæœåŠ¡å™¨ä¸Šå¯åŠ¨ä¸€ä¸ªnpcï¼‰ |
| `allow_connection_num_limit` | æ˜¯å¦é™åˆ¶å®¢æˆ·ç«¯æœ€å¤§è¿æ¥æ•° |
| `allow_multi_ip` | æ˜¯å¦å…è®¸é…ç½®éš§é“ç›‘å¬IPåœ°å€ |
| `system_info_display` | æ˜¯å¦æ˜¾ç¤ºç³»ç»Ÿè´Ÿè½½ç›‘æ§ä¿¡æ¯ |
| `disconnect_timeout` | TCP ä¸­æ–­è¶…æ—¶ç­‰å¾…æ—¶é—´ï¼ˆå•ä½ 5sï¼Œé»˜è®¤å€¼ 60ï¼Œå³ 300s = 5minsï¼‰ |
| `http_cache` | æ˜¯å¦å¯ç”¨ HTTP ç¼“å­˜ï¼ˆå·²å¼ƒç”¨ï¼Œä¸å†æ”¯æŒè¯¥åŠŸèƒ½ï¼‰ |

---

âœ… **å¦‚éœ€æ›´å¤šå¸®åŠ©ï¼Œè¯·æŸ¥çœ‹ [æ–‡æ¡£](https://github.com/djylb/nps) æˆ–æäº¤ [GitHub Issues](https://github.com/djylb/nps/issues) åé¦ˆé—®é¢˜ã€‚**