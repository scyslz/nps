# FAQï¼ˆå¸¸è§é—®é¢˜è§£ç­”ï¼‰

---

## 1. æœåŠ¡ç«¯ç›¸å…³é—®é¢˜

### **æœåŠ¡ç«¯æ— æ³•å¯åŠ¨**
```
æœåŠ¡ç«¯é»˜è®¤é…ç½®å¯ç”¨äº† 8024ã€8080ã€80ã€443 ç«¯å£ï¼Œç«¯å£å†²çªå¯èƒ½å¯¼è‡´æ— æ³•å¯åŠ¨ï¼Œè¯·ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ç«¯å£è®¾ç½®ã€‚
```

### **æœåŠ¡ç«¯é…ç½®æ–‡ä»¶ä¿®æ”¹æ— æ•ˆ**
```
Linux å®‰è£…åï¼Œé…ç½®æ–‡ä»¶ä½äº `/etc/nps`ï¼Œè¯·ä¿®æ”¹è¯¥è·¯å¾„ä¸‹çš„ `nps.conf`ã€‚
```

### **å…³äº IPv6 æ”¯æŒ**
```
NPS é»˜è®¤æ”¯æŒ IPv6ï¼Œæ— éœ€é¢å¤–é…ç½®ï¼Œå·²åœ¨ IPv4/IPv6 åŒæ ˆåè®®ä¸Šç›‘å¬ã€‚
```

---

## 2. å®¢æˆ·ç«¯ç›¸å…³é—®é¢˜

### **å®¢æˆ·ç«¯æ— æ³•è¿æ¥æœåŠ¡ç«¯**
```
è¯·æ£€æŸ¥ï¼š
1. æœåŠ¡å™¨é˜²ç«å¢™ / äº‘æä¾›å•†çš„å®‰å…¨ç»„æ˜¯å¦å¼€æ”¾ç›¸å…³ç«¯å£ã€‚
2. å®¢æˆ·ç«¯ vkey æ˜¯å¦ä¸æœåŠ¡å™¨ç«¯é…ç½®åŒ¹é…ã€‚
3. å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ NPS ç‰ˆæœ¬æ˜¯å¦å…¼å®¹ã€‚
```

### **å®¢æˆ·ç«¯éš§é“ç«¯å£è¿ä¸ä¸Š**
```
å¦‚æœä½¿ç”¨ Docker éƒ¨ç½²ï¼Œä½†æœªæŒ‡å®š `--net=host` ç½‘ç»œæ¨¡å¼ï¼š
- éš§é“ç«¯å£åº”ç”± `NPS` æœåŠ¡ç«¯æš´éœ²ï¼Œè€Œé `NPC` å®¢æˆ·ç«¯ã€‚
- `NPS` ä½œä¸ºä»£ç†æœåŠ¡å™¨ï¼Œ`NPC` ä»…ä½œä¸ºéš§é“å®¢æˆ·ç«¯ã€‚
```

### **p2pç©¿é€å¤±è´¥ [p2pæœåŠ¡](/example?id=p2pæœåŠ¡)**
```
åŒæ–¹natç±»å‹éƒ½æ˜¯Symmetric Natä¸€å®šä¸æˆåŠŸï¼Œå»ºè®®å…ˆæŸ¥çœ‹natç±»å‹ã€‚è¯·æŒ‰ç…§æ–‡æ¡£æ“ä½œ(æ ‡é¢˜ä¸Šæœ‰è¶…é“¾æ¥)
```

### **å®¢æˆ·ç«¯å‘½ä»¤è¡Œæ–¹å¼å¯åŠ¨å¤šä¸ªéš§é“**
```
æ”¯æŒä½¿ç”¨é€—å·æ‹¼æ¥å¤šä¸ªéš§é“ IDï¼š
npc -server=xxx:8024 -vkey=ytkpyr0er676m0r7,iwnbjfbvygvzyzzt
```

---

## 3. åå‘ä»£ç†ç›¸å…³é—®é¢˜

### **NPS ä½œä¸ºåå‘ä»£ç†ï¼Œå¦‚ä½•ä¿ç•™çœŸå® IPï¼Ÿ**
```
å½“ NPS ç›´æ¥ä»£ç† HTTP/HTTPS è¯·æ±‚æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `X-Forwarded-For` æˆ– `X-Real-IP` å¤´è·å–çœŸå®å®¢æˆ·ç«¯ IPï¼š
- ç¡®ä¿ `nps.conf` é‡Œ `http_add_origin_header=true`
- ç›®æ ‡æœåŠ¡å™¨ï¼ˆåç«¯ Web æœåŠ¡å™¨ï¼‰å¯ä½¿ç”¨ï¼š
  - `X-Forwarded-For` å¤´æ¥è·å–åŸå§‹ IP
  - `X-Real-IP` å¤´è·å–ç¬¬ä¸€ä¸ªä»£ç†çš„ IP
å¦‚æœæ˜¯TCPéš§é“æˆ–è€…é…ç½®ç”±åç«¯å¤„ç†HTTPS (ä»…è½¬å‘)çš„è¯å¯ä»¥å¯ç”¨Proxy Protocolæ¥ä¼ é€’IPä¿¡æ¯ï¼Œéœ€è¦åç«¯æœåŠ¡æ”¯æŒè¯¥åè®®ã€‚
```

### **NPS ä½œä¸ºåç«¯ï¼Œè¢« Nginx/Caddy ä»£ç†æ—¶å¦‚ä½•é…ç½®ï¼Ÿ**
```
å¦‚æœ Nginx/Caddy ä½œä¸ºå‰ç«¯ä»£ç† NPSï¼Œå»ºè®®å®ƒä»¬æä¾› SSL è¯ä¹¦ï¼Œå¹¶ä½¿ç”¨ `X-NPS-Http-Only` å¤´ï¼š
- é¿å… NPS è‡ªåŠ¨ 301 é‡å®šå‘
- ä¼ é€’çœŸå®å®¢æˆ·ç«¯ IP
```
#### **Nginx é…ç½®ç¤ºä¾‹**
```nginx
server {
    listen 443 ssl;
    server_name _;

    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    location / {
        proxy_pass http://127.0.0.1:80;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        proxy_set_header Host $http_host;

        # è¿™é‡Œå¡« NPS é…ç½®æ–‡ä»¶ä¸­å¡«å†™çš„å¯†ç 
        proxy_set_header X-NPS-Http-Only "password";
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

        proxy_redirect off;
        proxy_buffering off;
    }
}
```
> ğŸ“Œ **è¯´æ˜**ï¼š
> - `X-NPS-Http-Only` é¿å… NPS å¤„ç† 301 é‡å®šå‘
> - `X-Real-IP` & `X-Forwarded-For` ä¼ é€’çœŸå®å®¢æˆ·ç«¯ IP
> - NPS å¤„ç† HTTP ä»£ç†æµé‡ï¼Œä¸æä¾› SSL è¯ä¹¦

---

## 4. åŸŸåè½¬å‘ä¸ HTTPS ç›¸å…³é—®é¢˜

### **å¦‚ä½•é…ç½® HTTPS è¯ä¹¦å’Œå¯†é’¥ï¼Ÿ**
```
NPS æ”¯æŒ HTTPS è¯ä¹¦å’Œå¯†é’¥ï¼Œå¯ä»¥ä½¿ç”¨æ–‡ä»¶è·¯å¾„æˆ–ç›´æ¥å¡«å…¥è¯ä¹¦å†…å®¹ï¼š
- **è·¯å¾„æ”¯æŒ**ï¼šç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ï¼ˆç›¸å¯¹è·¯å¾„åŸºäº NPS äºŒè¿›åˆ¶æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼‰ã€‚
- **Docker ç”¨æˆ·**ï¼šè¯·ä½¿ç”¨ç¡¬é“¾æ¥ï¼Œè€Œéè½¯é“¾æ¥ã€‚
```

### **Auto CORS è‡ªåŠ¨è·¨åŸŸ**
```
NPS å¯è‡ªåŠ¨æ’å…¥ CORS å¤´éƒ¨ï¼Œå…è®¸è·¨åŸŸè®¿é—®ï¼Œä½†å»ºè®®åœ¨åç«¯å®ç°æ›´ç»†ç²’åº¦çš„æ§åˆ¶ã€‚
```

### **åŸŸåè½¬å‘ HTTPS å¤„ç†é€»è¾‘**
```
1. è®¿é—® NPS æ—¶ä½¿ç”¨çš„æ¨¡å¼ â‰  åç«¯æœåŠ¡å™¨æ¨¡å¼ã€‚
2. ç›®æ ‡åº”å¡«å†™ **åç«¯ HTTP ç«¯å£**ï¼ŒNPS ä¼šè‡ªåŠ¨è½¬å‘ã€‚
3. å¦‚åç«¯ä»…æ”¯æŒ HTTPSï¼š
   - é€‰æ‹© `HTTPS` ä½œä¸ºåç«¯ç±»å‹ã€‚
   - å¯å¯ç”¨ `ç”±åç«¯å¤„ç† HTTPSï¼ˆä»…è½¬å‘ï¼‰`ï¼Œé¿å… NPS éœ€è¦è¯ä¹¦ã€‚
```
**HTTPS å¤„ç†ä¼˜å…ˆçº§ï¼š**
```
1. ç”¨æˆ·è‡ªå®šä¹‰è¯ä¹¦
2. é»˜è®¤è¯ä¹¦
3. ç”±åç«¯å¤„ç† HTTPSï¼ˆä»…è½¬å‘ï¼‰
```
---

## 5. æ—¥å¿—ä¸è°ƒè¯•

### **å¦‚ä½•æŸ¥çœ‹æ—¥å¿—ï¼Ÿ**
```
æ—¥å¿—è·¯å¾„å¯åœ¨ `nps.conf` é‡Œé…ç½®ï¼š
1. Windows é»˜è®¤æ—¥å¿—æ–‡ä»¶ï¼šå½“å‰è¿è¡Œç›®å½•ä¸‹çš„ `nps.log`
2. Linux/macOS é»˜è®¤æ—¥å¿—è·¯å¾„ï¼š`/var/log/nps.log`
```

### **NPS æ—¥å¿—é…ç½®ï¼ˆnps.confï¼‰**
```ini
# æ—¥å¿—çº§åˆ« (0-7) LevelEmergency->0  LevelAlert->1 LevelCritical->2 LevelError->3 LevelWarning->4 LevelNotice->5 LevelInformational->6 LevelDebug->7
log_level=7

# æ—¥å¿—è·¯å¾„ï¼ˆè·¯å¾„ | off | dockerï¼‰
log_path=off

# æ˜¯å¦æŒ‰æ—¥æœŸä¿å­˜æ—¥å¿—
log_daily=false

# å…è®¸å­˜åœ¨çš„æ—¥å¿—æ€»æ–‡ä»¶ä¸ªæ•°
log_max_files=10

# å…è®¸ä¿å­˜æ—¥å¿—çš„æœ€å¤§å¤©æ•°
log_max_days=7

# å•ä¸ªæ—¥å¿—æ–‡ä»¶çš„æœ€å¤§å¤§å°ï¼ˆMBï¼‰ï¼Œè¶…è¿‡å¤§å°æˆ–æ—¥å¿—è¶…è¿‡ 100000 è¡Œåˆ™æ–°å¢æ—¥å¿—æ–‡ä»¶
log_max_size=2
```

---

## 6. å…¶ä»–åŠŸèƒ½ç›¸å…³

### **åˆ°æœŸæ—¶é—´é™åˆ¶**
```
NPS æ”¯æŒå®¢æˆ·ç«¯åˆ°æœŸæ—¶é—´ï¼Œåœ¨ `nps.conf` é‡Œæ·»åŠ ï¼š
allow_time_limit=true
å¯åœ¨ Web ç®¡ç†ç•Œé¢æ‰‹åŠ¨è®¾ç½®åˆ°æœŸæ—¶é—´ã€‚

ç¤ºä¾‹ï¼š
2025-01-01
æˆ–
2025-01-01 00:00:00 +0800 CST
```

### **TLS ç«¯å£è®¾ç½®**
```
`nps.conf` æ–°å¢ `tls_bridge_port=8025`ï¼Œå½“ `tls_bridge_port` ä¸ä¸º `0` æ—¶ï¼ŒNPS ä¼šç›‘å¬ 8025 ç«¯å£ã€‚

å®¢æˆ·ç«¯å¯é€‰æ‹©è¿æ¥ TLS ç«¯å£æˆ–é TLS ç«¯å£ï¼š
- `npc.exe -server=xxx:8024 -vkey=xxx`
- `npc.exe -server=xxx:8025 -vkey=xxx -type=tls`
```

### **åŒæ—¶è¿æ¥å¤šå°æœåŠ¡å™¨**
```
å®¢æˆ·ç«¯æ”¯æŒåŒæ—¶è¿æ¥å¤šä¸ªæœåŠ¡å™¨ï¼Œç¤ºä¾‹ï¼š  
`npc -server=xxx:123,yyy:456,zzz:789 -vkey=key1,key2,key3 -type=tcp,tls`  
è¿™é‡Œ `xxx:123` ä½¿ç”¨ tcp, `yyy:456` å’Œ `zzz:789` ä½¿ç”¨tls
```

### **NPS è¯»å–æŒ‡å®šé…ç½®æ–‡ä»¶**
```
æ–°å¢ `-conf_path` å‚æ•°ï¼Œå…è®¸ NPS è¯»å–æŒ‡å®šé…ç½®è·¯å¾„åŠ Web èµ„æºæ–‡ä»¶ã€‚

Windows ç¤ºä¾‹ï¼š
- ç›´æ¥å¯åŠ¨ï¼š`nps.exe -conf_path=D:\test\nps`
- å®‰è£…æœåŠ¡ï¼š`nps.exe install -conf_path=D:\test\nps`
- å¯åŠ¨æœåŠ¡ï¼š`nps.exe start`

Linux ç¤ºä¾‹ï¼š
- ç›´æ¥å¯åŠ¨ï¼š`./nps -conf_path=/app/nps`
- å®‰è£…æœåŠ¡ï¼š`./nps install -conf_path=/app/nps`
- å¯åŠ¨æœåŠ¡ï¼š`nps start -conf_path=/app/nps`
```

---

> **å¦‚é‡é—®é¢˜ï¼Œè¯·å…ˆæ£€æŸ¥æ—¥å¿—ï¼Œç¡®ä¿é˜²ç«å¢™ã€ç«¯å£å¼€æ”¾ï¼Œæˆ–è‡³ [GitHub Issues](https://github.com/djylb/nps/issues) åé¦ˆé—®é¢˜ã€‚** âœ…